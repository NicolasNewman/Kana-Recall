var Z=Object.defineProperty;var $=(a,t,n)=>t in a?Z(a,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):a[t]=n;var B=(a,t,n)=>$(a,typeof t!="symbol"?t+"":t,n);import{s as ee,x as K,i as V,l as te,p as ae,n as F,f as k,e as S,S as ne,a as se,c as C,b as O,T as re,d as le,h as f,U as Q,j as T,g as X,t as oe,r as ie,u as ce}from"../chunks/scheduler.CyFU2WUr.js";import{h as ue,u as he}from"../chunks/await_block.DxHCDpKC.js";import{S as ye,i as fe}from"../chunks/index.DhbsmVG4.js";import{a as de,L as pe,g as N,k as ge,b as me,s as ve,r as we}from"../chunks/router.BAPWZOKB.js";import{r as ke,a as be,s as U}from"../chunks/math.Df0k8ivH.js";const _e=async({params:a})=>({mode:a.mode,kana:a.kana}),Ve=Object.freeze(Object.defineProperty({__proto__:null,load:_e},Symbol.toStringTag,{value:"Module"}));var A=function(){return{keys:[],values:[],length:0,put:function(a,t){this[a]=t,this.keys.push(a),this.values.push(t),this.length++},remove:function(a){delete this[a];for(var t=0;t>-1;)t=this.keys.indexOf(a),this.keys[t]="",this.values[t]=""}}},y=new A;y.put("kk","っk");y.put("tt","っt");y.put("cc","っc");y.put("ss","っs");y.put("pp","っp");y.put("mm","んm");y.put("mt","んt");y.put("mb","んb");y.put("mp","んp");y.put("nt","んt");y.put("nb","んb");y.put("np","んp");var R=[null,new A,new A,new A,new A],M=[null,new A,new A],e=function(a,t){R[a.length].put(a,t),M[t.length].put(t,a)};e("n","ん");e("nnn","んn");e("nn","ん");e("xn","ん");e("n'","ん");e("nʺ","ん");e("a","あ");e("i","い");e("u","う");e("e","え");e("o","お");e("yi","い");e("wu","う");e("whu","う");e("la","ぁ");e("li","ぃ");e("lu","ぅ");e("le","ぇ");e("lo","ぉ");e("xa","ぁ");e("xi","ぃ");e("xu","ぅ");e("xe","ぇ");e("xo","ぉ");e("lyi","ぃ");e("xyi","ぃ");e("lye","ぇ");e("xye","ぇ");e("ye","いぇ");e("wi","うぃ");e("we","うぇ");e("wha","うぁ");e("whi","うぃ");e("whe","うぇ");e("who","うぉ");e("vu","ヴ");e("va","ヴぁ");e("vi","ヴぃ");e("vyi","ヴぃ");e("ve","ヴぇ");e("vye","ヴぇ");e("vo","ヴぉ");e("vya","ヴゃ");e("vyu","ヴゅ");e("vyo","ヴょ");e("ka","か");e("ki","き");e("ku","く");e("ke","け");e("ko","こ");e("ca","か");e("cu","く");e("co","こ");e("qu","く");e("kya","きゃ");e("kyi","きぃ");e("kyu","きゅ");e("kye","きぇ");e("kyo","きょ");e("qya","くゃ");e("qyu","くゅ");e("qyo","くょ");e("lka","ヵ");e("xka","ヵ");e("lke","ヶ");e("xke","ヶ");e("qwa","くぁ");e("qwi","くぃ");e("qwu","くぅ");e("qwe","くぇ");e("qwo","くぉ");e("qa","くぁ");e("qi","くぃ");e("qe","くぇ");e("qo","くぉ");e("kwa","くぁ");e("qyi","くぃ");e("qye","くぇ");e("ga","が");e("gi","ぎ");e("gu","ぐ");e("ge","げ");e("go","ご");e("gya","ぎゃ");e("gyi","ぎぃ");e("gyu","ぎゅ");e("gye","ぎぇ");e("gyo","ぎょ");e("gwa","ぐぁ");e("gwi","ぐぃ");e("gwu","ぐぅ");e("gwe","ぐぇ");e("gwo","ぐぉ");e("shi","し");e("sa","さ");e("si","し");e("su","す");e("se","せ");e("so","そ");e("ci","し");e("ce","せ");e("sha","しゃ");e("shu","しゅ");e("she","しぇ");e("sho","しょ");e("sya","しゃ");e("syi","しぃ");e("syu","しゅ");e("sye","しぇ");e("syo","しょ");e("swa","すぁ");e("swi","すぃ");e("swu","すぅ");e("swe","すぇ");e("swo","すぉ");e("ji","じ");e("za","ざ");e("zi","じ");e("zu","ず");e("ze","ぜ");e("zo","ぞ");e("ja","じゃ");e("ju","じゅ");e("je","じぇ");e("jo","じょ");e("jya","じゃ");e("jyi","じぃ");e("jyu","じゅ");e("jye","じぇ");e("jyo","じょ");e("zya","じゃ");e("zyi","じぃ");e("zyu","じゅ");e("zye","じぇ");e("zyo","じょ");e("chi","ち");e("tsu","つ");e("ta","た");e("ti","ち");e("tu","つ");e("te","て");e("to","と");e("cha","ちゃ");e("chu","ちゅ");e("che","ちぇ");e("cho","ちょ");e("tya","ちゃ");e("tyi","ちぃ");e("tyu","ちゅ");e("tye","ちぇ");e("tyo","ちょ");e("cya","ちゃ");e("cyi","ちぃ");e("cyu","ちゅ");e("cye","ちぇ");e("cyo","ちょ");e("ltu","っ");e("xtu","っ");e("ltsu","っ");e("tsa","つぁ");e("tsi","つぃ");e("tse","つぇ");e("tso","つぉ");e("tha","てゃ");e("thi","てぃ");e("thu","てゅ");e("the","てぇ");e("tho","てょ");e("twa","とぁ");e("twi","とぃ");e("twu","とぅ");e("twe","とぇ");e("two","とぉ");e("dzu","づ");e("dzi","ぢ");e("da","だ");e("di","ぢ");e("du","づ");e("de","で");e("do","ど");e("dya","ぢゃ");e("dyi","ぢぃ");e("dyu","ぢゅ");e("dye","ぢぇ");e("dyo","ぢょ");e("dha","でゃ");e("dhi","でぃ");e("dhu","でゅ");e("dhe","でぇ");e("dho","でょ");e("dwa","どぁ");e("dwi","どぃ");e("dwu","どぅ");e("dwe","どぇ");e("dwo","どぉ");e("na","な");e("ni","に");e("nu","ぬ");e("ne","ね");e("no","の");e("nya","にゃ");e("nyi","にぃ");e("nyu","にゅ");e("nye","にぇ");e("nyo","にょ");e("fu","ふ");e("ha","は");e("hi","ひ");e("hu","ふ");e("he","へ");e("ho","ほ");e("hya","ひゃ");e("hyi","ひぃ");e("hyu","ひゅ");e("hye","ひぇ");e("hyo","ひょ");e("fya","ふゃ");e("fyi","ふぃ");e("fyu","ふゅ");e("fye","ふぇ");e("fyo","ふょ");e("fa","ふぁ");e("fi","ふぃ");e("fe","ふぇ");e("fo","ふぉ");e("ba","ば");e("bi","び");e("bu","ぶ");e("be","べ");e("bo","ぼ");e("bya","びゃ");e("byi","びぃ");e("byu","びゅ");e("bye","びぇ");e("byo","びょ");e("va","ヴぁ");e("vi","ヴぃ");e("vu","ヴ");e("ve","ヴぇ");e("vo","ヴぉ");e("vya","ヴゃ");e("vyi","ヴぃ");e("vyu","ヴゅ");e("vye","ヴぇ");e("vyo","ヴょ");e("pa","ぱ");e("pi","ぴ");e("pu","ぷ");e("pe","ぺ");e("po","ぽ");e("pya","ぴゃ");e("pyi","ぴぃ");e("pyu","ぴゅ");e("pye","ぴぇ");e("pyo","ぴょ");e("ma","ま");e("mi","み");e("mu","む");e("me","め");e("mo","も");e("mya","みゃ");e("myi","みぃ");e("myu","みゅ");e("mye","みぇ");e("myo","みょ");e("ya","や");e("yu","ゆ");e("yo","よ");e("lya","ゃ");e("lyu","ゅ");e("lyo","ょ");e("xya","ゃ");e("xyu","ゅ");e("xyo","ょ");e("ra","ら");e("ri","り");e("ru","る");e("re","れ");e("ro","ろ");e("rya","りゃ");e("ryi","りぃ");e("ryu","りゅ");e("rye","りぇ");e("ryo","りょ");e("wa","わ");e("wyi","ゐ");e("wye","ゑ");e("wo","を");e("lwa","ゎ");e("xwa","ゎ");e("-","ー");var W=["ぁ","あ","ぃ","い","ぅ","う","ぇ","え","ぉ","お","か","が","き","ぎ","く","ぐ","け","げ","こ","ご","さ","ざ","し","じ","す","ず","せ","ぜ","そ","ぞ","た","だ","ち","ぢ","っ","つ","づ","て","で","と","ど","な","に","ぬ","ね","の","は","ば","ぱ","ひ","び","ぴ","ふ","ぶ","ぷ","へ","べ","ぺ","ほ","ぼ","ぽ","ま","み","む","め","も","ゃ","や","ゅ","ゆ","ょ","よ","ら","り","る","れ","ろ","ゎ","わ","ゐ","ゑ","を","ん","ゔ","ゕ","ゖ","わ゛","ゐ゛","ゑ゛","を゛"],G=["ァ","ア","ィ","イ","ゥ","ウ","ェ","エ","ォ","オ","カ","ガ","キ","ギ","ク","グ","ケ","ゲ","コ","ゴ","サ","ザ","シ","ジ","ス","ズ","セ","ゼ","ソ","ゾ","タ","ダ","チ","ヂ","ッ","ツ","ヅ","テ","デ","ト","ド","ナ","ニ","ヌ","ネ","ノ","ハ","バ","パ","ヒ","ビ","ピ","フ","ブ","プ","ヘ","ベ","ペ","ホ","ボ","ポ","マ","ミ","ム","メ","モ","ャ","ヤ","ュ","ユ","ョ","ヨ","ラ","リ","ル","レ","ロ","ヮ","ワ","ヰ","ヱ","ヲ","ン","ヴ","ヵ","ヶ","ヷ","ヸ","ヹ","ヺ"],xe=/[\u3300-\u33FF\u3400-\u4DBF\u4E00-\u9FFF\uF900-\uFAFF]/,q=function(a,t,n){var s,r=a.length;for(s=0;s<r;s++)n=n.replace(new RegExp(a[s],"g"),t[s]);return n},J={convert:function(a){var t={kanji:!1,hiragana:!1,katakana:!1,romaji:a};if(new RegExp(xe).test(a))return t.kanji=a,t.romaji=!1,t;new RegExp("[぀-ヿ]").test(a)&&(t.romaji=this.romanise(a)),t.katakana=q(["aa","ii","uu","ee","oo"],["a-","i-","u-","e-","o-"],a),t.katakana=q(y.keys,y.values,t.katakana),t.hiragana=q(y.keys,y.values,a);for(var n=4;n>0;n--)R[n]&&(t.katakana=q(R[n].keys,R[n].values,t.katakana),t.hiragana=q(R[n].keys,R[n].values,t.hiragana));return t.katakana=q(W,G,t.katakana),new RegExp("[A-Za-z]").test(t.katakana)?!1:(new RegExp("[゠-ヿ]").test(t.hiragana)&&(t.hiragana=!1),t.romaji&&(t.romaji=t.romaji.replace(/っ$/,"!")),t)},romanise:function(a){new RegExp("[゠-ヿ]").test(a)&&(a=q(G,W,a)),M[1].remove("っ");var t=a;return t=q(M[2].keys,M[2].values,t),t=q(M[1].keys,M[1].values,t),t=t.replace(/っ(\w)/g,"$1$1"),t=t.replace(/っ$/,"!"),t}};class je{constructor(){B(this,"date");this.date=new Date}start(){this.date=new Date}end(){return(new Date().valueOf()-this.date.valueOf()).valueOf()/1e3}}function qe(a){return{c:F,l:F,m:F,p:F,d:F}}function Fe(a){let t,n,s,r,o,u,m,D;function I(l,p){return l[0]?Se:ze}let _=I(a),d=_(a);return{c(){t=S("div"),n=S("div"),s=S("div"),r=new ne(!1),u=se(),m=S("div"),d.c(),this.h()},l(l){t=C(l,"DIV",{id:!0,class:!0});var p=O(t);n=C(p,"DIV",{id:!0,class:!0});var z=O(n);s=C(z,"DIV",{class:!0});var i=O(s);r=re(i,!1),i.forEach(k),u=le(z),m=C(z,"DIV",{class:!0});var H=O(m);d.l(H),H.forEach(k),z.forEach(k),p.forEach(k),this.h()},h(){r.a=null,f(s,"class",o=`NotoSansMono w-full ${a[0]?"h-full":""}`),f(m,"class",D=`mt-2 flex items-center ${a[0]?"":"h-full"}`),f(n,"id","content"),f(n,"class","flex flex-col items-center justify-between rounded-lg border-2 p-1 pl-2 border-gray-800 h-full bg-gray-900 text-[36px] leading-10 text-white"),f(t,"id","container"),f(t,"class",Q(`p-8 bg-cover ${a[3]}`)+" svelte-qscg7y")},m(l,p){V(l,t,p),T(t,n),T(n,s),r.m(a[2],s),T(n,u),T(n,m),d.m(m,null)},p(l,p){p&4&&r.p(l[2]),p&1&&o!==(o=`NotoSansMono w-full ${l[0]?"h-full":""}`)&&f(s,"class",o),_===(_=I(l))&&d?d.p(l,p):(d.d(1),d=_(l),d&&(d.c(),d.m(m,null))),p&1&&D!==(D=`mt-2 flex items-center ${l[0]?"":"h-full"}`)&&f(m,"class",D)},d(l){l&&k(t),d.d()}}}function ze(a){let t,n;return{c(){t=S("div"),n=oe(a[1]),this.h()},l(s){t=C(s,"DIV",{class:!0});var r=O(t);n=ie(r,a[1]),r.forEach(k),this.h()},h(){f(t,"class","p-1 w-16 h-10 text-2xl text-center bg-slate-800 border border-gray-300 rounded")},m(s,r){V(s,t,r),T(t,n)},p(s,r){r&2&&ce(n,s[1])},d(s){s&&k(t)}}}function Se(a){let t,n="Home";return{c(){t=S("a"),t.textContent=n,this.h()},l(s){t=C(s,"A",{href:!0,class:!0,"data-svelte-h":!0}),X(t)!=="svelte-1i1u2mc"&&(t.textContent=n),this.h()},h(){f(t,"href",we.home),f(t,"class","btn btn-primary w-full mt-auto mb-4")},m(s,r){V(s,t,r)},p:F,d(s){s&&k(t)}}}function Ce(a){let t,n,s='<div class="spinner"></div>';return{c(){t=S("div"),n=S("div"),n.innerHTML=s,this.h()},l(r){t=C(r,"DIV",{id:!0,class:!0});var o=O(t);n=C(o,"DIV",{id:!0,class:!0,"data-svelte-h":!0}),X(n)!=="svelte-1xeqaee"&&(n.innerHTML=s),o.forEach(k),this.h()},h(){f(n,"id","content"),f(n,"class","flex flex-col items-center justify-between rounded-lg border-2 p-1 pl-2 border-gray-800 h-full bg-gray-900 text-[36px] leading-10 text-white"),f(t,"id","container"),f(t,"class",Q(`p-8 bg-cover ${a[3]}`)+" svelte-qscg7y")},m(r,o){V(r,t,o),T(t,n)},p:F,d(r){r&&k(t)}}}function De(a){let t,n,s,r={ctx:a,current:null,token:null,hasCatch:!1,pending:Ce,then:Fe,catch:qe,value:17};return ue(a[4],r),{c(){t=K(),r.block.c()},l(o){t=K(),r.block.l(o)},m(o,u){V(o,t,u),r.block.m(o,r.anchor=u),r.mount=()=>t.parentNode,r.anchor=t,n||(s=te(window,"keydown",ae(a[5])),n=!0)},p(o,[u]){a=o,he(r,a,u)},i:F,o:F,d(o){o&&k(t),r.block.d(o),r.token=null,r=null,n=!1,s()}}}function Ee(a,t,n){const s=me(),r=s==="web"?"aspect-[50/29] w-[700px] border border-gray rounded-md":s==="desktop"?"h-[calc(100vh-30px)]":"";s==="desktop"&&de.setSize(new pe(700,404));let{data:o}=t;const{mode:u,kana:m}=o,D=N("keyset",!0)??ge.hira,I=N("stats"),_=N("settings"),d=new je;let l="",p=!1,z="",i=[];const H=(async()=>{n(7,i=[]);let c=[...D];if(u==="test"||u==="practice")for(let g=0;g<102;g++){c.length===0&&(c=[...D]);const x=ke(c.length);i.push(c[x]),c.splice(x,1)}else if((u==="recall"||u==="accuracy")&&m){const g=Object.entries(I[m]).map(([w,j])=>{let h=be(j,u);return u==="accuracy"&&(h=1-h),console.log(`${w}: ${h}`),Math.tanh(.25*h)}),x=U(g);for(let w=0;w<102;w++){const j=Math.random()*x;let h=0,b=0;for(b=0;b<g.length&&!(h<=j&&j<=h+g[b]);b++)h+=g[b];i.push(c[b])}}})();let v=[];function Y(c){var j;if(v.length===i.length)return;const g=c.key;if(g==="Backspace"){l.length>0&&n(1,l=l.slice(0,l.length-1));return}let x=g.match(/[a-z]/);if(v.length===i.length-1&&u==="test"&&ve("stats",I),v.length<i.length&&x&&((j=x.input)==null?void 0:j.length)===1)p?(n(1,l=g),p=!1):n(1,l=l+g);else return;let w=J.convert(l);if(l==="nn"?w=J.convert("n"):l==="n"&&(w=!1),w){let h=!1,b=v.length;if((i[b]===w.hiragana||i[b]===w.katakana)&&(h=!0),n(8,v=[...v,h]),p=!0,n(1,l=""),m){const E=I[m][i[b]];if(E.allTime[h?"correct":"incorrect"]++,E.recent.accuracy.length>=_.recentStatCount&&E.recent.accuracy.shift(),E.recent.accuracy.push(h?1:0),h){E.recent.recall.length>=_.recentStatCount&&E.recent.recall.shift();let P=d.end();P>_.maxRecallDuration&&(P=_.maxRecallDuration),E.recent.recall.push(P)}d.start()}}l.length>2&&n(1,l="")}let L=!1;return a.$$set=c=>{"data"in c&&n(6,o=c.data)},a.$$.update=()=>{if(a.$$.dirty&385)if(n(0,L=v.length===i.length),L){const c=U(v);n(2,z=`
			<div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%">
				<span style="border-bottom: 2px solid #fff; padding-bottom: 5px; width: 40%; text-align: center">Finished!</span>
				<span>Correct: ${c}</span>
				<span>Incorrect: ${i.length-c}</span>
				<span>
					Accuracy: ${(c/v.length*100).toFixed(1)}%
				</span>
			</div>`)}else{const c=v.reduce((w,j,h)=>`${w}<span class="${j?"correct":"wrong"}">${i[h]}</span>`,""),g=`<span class="underline">${i[v.length]??""}</span>`,x=i.slice(v.length+1,i.length).join("");n(2,z=c+g+x)}},[L,l,z,r,H,Y,o,i,v]}class He extends ye{constructor(t){super(),fe(this,t,Ee,De,ee,{data:6})}}export{He as component,Ve as universal};
